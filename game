// New Leaderboard Variable
var leaderboard = []; 

function updateLeaderboard(playerName, score) {
  let found = false;
  for (let p of leaderboard) {
    if (p.name === playerName) {
      p.score += score;
      found = true;
      break;
    }
  }
  if (!found) leaderboard.push({ name: playerName, score: score });
  
  // Sort by highest score
  leaderboard.sort((a, b) => b.score - a.score);
}

function drawHUD() {
  fill(30); rect(0, 0, width, 200);
  
  // Status & Stats (Online/Ping/Gold/Luck)
  drawStatusAndStats();

  // Server Logs & Leaderboard
  fill(20); rect(400, 10, 430, 180, 5);
  fill(0, 255, 0); textSize(11);
  
  // Left side of log: Activity
  for(let i=0; i < serverLogs.length; i++) {
    text("> " + serverLogs[i], 410, 30 + (i * 18));
  }
  
  // Right side of log: Leaderboard
  fill(255, 215, 0);
  text("--- TOP ANGLERS ---", 650, 30);
  fill(255);
  for(let i=0; i < min(leaderboard.length, 5); i++) {
    let prefix = (i === 0) ? "ðŸ‘‘ " : (i+1) + ". ";
    text(prefix + leaderboard[i].name + ": " + leaderboard[i].score, 650, 50 + (i * 18));
  }
}

function performRestart() {
  // Announce Winners
  if (leaderboard.length > 0) {
     addLog("WINNER: " + leaderboard[0].name + " with " + leaderboard[0].score + " pts!");
  }
  
  // Reset Everything
  leaderboard = [];
  catchCount = 0;
  serverLogs = ["System Rebooted.", "Luck Rerolled."];
  updateServerLuck();
  for (let f of fishes) f.reset();
  inMiniGame = false;
  restartTimer = -1;
}

function finishCatch() {
  // Update Leaderboard (In a 35-player server, this would be your name)
  updateLeaderboard("You", targetFish.val);
  
  addLog("CATCH: " + targetFish.rarity);
  inMiniGame = false;
  gold += targetFish.val;
  targetFish.x = -500;
  setTimeout(() => { targetFish.reset(); }, 2000);
}
